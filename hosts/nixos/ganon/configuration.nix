# Ganon - Gaming PC Configuration
# x86_64-linux with NVIDIA GPU, dual-boot with Windows
{
  inputs,
  myLibs,
  pkgs,
  ...
}:

{
  imports = [
    # Hardware configuration (will be generated by nixos-anywhere)
    ./hardware-configuration.nix

    # Disko disk configuration
    ./disks.nix

    # Base NixOS configuration
    ../../../modules/nixos/common.nix

    # SOPS for secrets management
    ../../../modules/nixos/sops.nix
  ];

  # Host specification
  hostSpec = {
    hostName = "ganon";
    isGaming = true;
  };

  # Set hostname
  networking.hostName = "ganon";

  # NVIDIA drivers (hardware requirement)
  hardware.nvidia = {
    modesetting.enable = true;
    powerManagement.enable = false;
    powerManagement.finegrained = false;
    open = false; # Use proprietary driver
    nvidiaSettings = true;
    package = config.boot.kernelPackages.nvidiaPackages.stable;
  };

  # Enable OpenGL (required for NVIDIA)
  hardware.graphics = {
    enable = true;
    enable32Bit = true;
  };

  # Gaming performance optimization (system-level)
  programs.gamemode = {
    enable = true;
    enableRenice = true;
    settings = {
      general = {
        softrealtime = "auto";
        renice = 15;
      };
    };
  };

  # Gaming-specific kernel settings
  boot.kernel.sysctl = {
    "vm.max_map_count" = 2147483642; # Helps with gaming performance
  };

  system.stateVersion = "24.05";
}